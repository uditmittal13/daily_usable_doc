Below is a **complete, practical cheat-sheet of MongoDB commands specifically for Kubernetes**, covering **cluster setup, deployment, scaling, backup, troubleshooting, and day-2 operations**.
This is written assuming **MongoDB Community Edition on Kubernetes**

---
-o wide > to get the complete information regarding pods,
-w     >  to see live changes
-watch >  to see live events with get events commands
--
Ques how to vlaidate pod running on which node???  (just need to add -o wide)
kubectl get pods -n mongod -o wide

Ques can we watch real time events in namespace??? ( observe real time events like pod scheduling/terminating/deleting/rescheduling inetead of final state)
kubectl get events -n mongod --watch
  Similare question:- how to Watch only scheduling-related events (filtered) ??? ( only need to add field selector)
kubectl get events -n mongod --field-selector reason=FailedScheduling  --watch

Ques how to  Watch pod status transitions live ( this will show live pods changes w.r.t namesapce) --just add -w
kubectl get pods -n mongod -w
kubectl get pods -n mongod -w -o wide ( can add -o wide for detailed information , what happening)


# üß© 1. Kubernetes Cluster ‚Äì Basic Commands (Mongo-related ops)

```bash
kubectl cluster-info
kubectl get nodes
kubectl get namespaces
kubectl create namespace mongodb
kubectl config set-context --current --namespace=mongodb
```

---

# üì¶ 2. MongoDB Deployment on Kubernetes

## Option A ‚Äì Standalone MongoDB (Dev / POC)

### Deployment

```bash
kubectl create deployment mongo \
  --image=mongo:7.0
```

### Expose MongoDB

```bash
kubectl expose deployment mongo \
  --type=ClusterIP \
  --port=27017
```

### Verify

```bash
kubectl get pods
kubectl get svc
```

---

## Option B ‚Äì MongoDB Replica Set (Recommended)

### StatefulSet (Best Practice)

```bash
kubectl apply -f mongo-statefulset.yaml
kubectl apply -f mongo-service.yaml
```

### Check Pods

```bash
kubectl get statefulsets
kubectl get pods -l app=mongo
```

---

# üíæ 3. Persistent Storage Commands

```bash
kubectl get pv
kubectl get pvc
kubectl describe pvc mongo-pvc
```

Delete PVC (‚ö† data loss):

```bash
kubectl delete pvc mongo-pvc
```

---

# üîê 4. Secrets & ConfigMaps (Mongo Credentials)

### Create Secret

```bash
kubectl create secret generic mongo-secret \
  --from-literal=username=admin \
  --from-literal=password=admin123
```

### View Secret

```bash
kubectl get secret mongo-secret
kubectl describe secret mongo-secret
```

---

# üîå 5. Connect to MongoDB in Kubernetes

### From Inside Pod

```bash
kubectl exec -it mongo-0 -- mongosh
```

With auth:

```bash
kubectl exec -it mongo-0 -- mongosh -u admin -p admin123
```

---

### Port Forward (Local Access)

```bash
kubectl port-forward svc/mongo 27017:27017
```

Then connect locally:

```bash
mongosh mongodb://localhost:27017
```

---

# üîÅ 6. MongoDB Replica Set Commands (Inside Pod)

```bash
rs.status()
rs.initiate()
```

Add members:

```javascript
rs.add("mongo-1.mongo:27017")
rs.add("mongo-2.mongo:27017")
```

Check primary:

```javascript
rs.isMaster()
```

---

# üìà 7. Scaling MongoDB in Kubernetes

### Scale Replica Set

```bash
kubectl scale statefulset mongo --replicas=3
```

Check pods:

```bash
kubectl get pods
```

‚ö† MongoDB **must also be added to replica set config**

---

# üß™ 8. Health Checks & Troubleshooting

### Pod Logs

```bash
kubectl logs mongo-0
kubectl logs mongo-0 --previous
```

### Describe Pod

```bash
kubectl describe pod mongo-0
```

### Exec into Pod

```bash
kubectl exec -it mongo-0 -- /bin/bash
```

---

# üîÑ 9. Backup & Restore in Kubernetes

## Backup

```bash
kubectl exec mongo-0 -- \
  mongodump --out /data/backup
```

Copy backup to local:

```bash
kubectl cp mongodb/mongo-0:/data/backup ./backup
```

---

## Restore

```bash
kubectl cp ./backup mongodb/mongo-0:/data/backup
```

```bash
kubectl exec mongo-0 -- \
  mongorestore /data/backup
```

---

# üåê 10. Exposing MongoDB Outside Cluster

### NodePort

```bash
kubectl expose statefulset mongo \
  --type=NodePort \
  --port=27017
```

### LoadBalancer (Cloud)

```bash
kubectl expose statefulset mongo \
  --type=LoadBalancer \
  --port=27017
```

---

# üîê 11. Security Best Practices (K8s + Mongo)

```bash
kubectl apply -f network-policy.yaml
kubectl apply -f mongo-tls-secret.yaml
```

Enable auth:

```yaml
--auth
```

---

# üìä 12. Monitoring & Resource Control

### Resource Usage

```bash
kubectl top pods
kubectl top nodes
```

### Limits & Requests (YAML)

```yaml
resources:
  requests:
    cpu: "500m"
    memory: "1Gi"
  limits:
    cpu: "1"
    memory: "2Gi"
```

---

# üßπ 13. Cleanup Commands

```bash
kubectl delete statefulset mongo
kubectl delete svc mongo
kubectl delete pvc mongo-pvc
kubectl delete namespace mongodb
```

---

# üß† 14. Real-World Production Setup (Recommended)

| Component    | Recommended              |
| ------------ | ------------------------ |
| MongoDB Type | Replica Set              |
| K8s Object   | StatefulSet              |
| Storage      | PVC (SSD)                |
| Auth         | Enabled                  |
| Backup       | CronJob                  |
| Monitoring   | Prometheus + Exporter    |
| Scaling      | Horizontal (Replica Set) |

---




